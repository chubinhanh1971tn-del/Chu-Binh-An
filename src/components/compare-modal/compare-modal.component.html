<div class="fixed inset-0 bg-black/70 z-40 flex items-center justify-center p-4 animate-fade-in" (click)="closeModal()">
  <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-7xl mx-auto animate-scale-up h-[90vh] flex flex-col" (click)="$event.stopPropagation()">
    
    <div class="flex justify-between items-center p-5 border-b border-gray-200 flex-shrink-0">
      <h3 class="text-2xl font-bold text-gray-800">So sánh Bất động sản</h3>
      <button (click)="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors" aria-label="Đóng">
        <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="flex-grow overflow-x-auto overflow-y-auto">
      <div class="min-w-max">
        <table class="w-full text-sm text-left text-gray-500 table-fixed">
          <thead class="text-xs text-gray-700 uppercase bg-gray-50 sticky top-0 z-10">
            <tr>
              <th scope="col" class="px-6 py-4 w-1/5 min-w-[200px] font-bold text-base">
                Tiêu chí
              </th>
              @for(property of properties(); track property.id) {
                <th scope="col" class="px-6 py-3 w-1/5 min-w-[250px]">
                  <img [ngSrc]="property.imageUrls[0]" [alt]="property.title" width="200" height="150" class="w-full h-24 object-cover rounded-md mb-2">
                  <h4 class="font-semibold text-gray-800 text-base line-clamp-2">{{ property.title }}</h4>
                  <p class="text-gray-500 text-xs line-clamp-1">{{ property.address }}</p>
                </th>
              }
            </tr>
          </thead>
          <tbody class="divide-y">
            <!-- Price -->
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 font-semibold text-gray-900 whitespace-nowrap">Giá</td>
              @for(property of properties(); track property.id) {
                <td class="px-6 py-4 text-lg font-bold text-green-700" [class.bg-green-100]="property.price === bestPrice()" [class.text-green-800]="property.price === bestPrice()">
                  {{ formatPrice(property.price) }}
                  @if (property.price === bestPrice()) {
                    <span class="ml-2 text-xs font-bold text-white bg-green-600 px-2 py-0.5 rounded-full">TỐT NHẤT</span>
                  }
                </td>
              }
            </tr>
            <!-- Area -->
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 font-semibold text-gray-900 whitespace-nowrap">Diện tích</td>
              @for(property of properties(); track property.id) {
                <td class="px-6 py-4 font-semibold" [class.bg-green-100]="property.area === bestArea()" [class.text-green-800]="property.area === bestArea()">
                  {{ property.area }} m²
                   @if (property.area === bestArea()) {
                    <span class="ml-2 text-xs font-bold text-white bg-green-600 px-2 py-0.5 rounded-full">LỚN NHẤT</span>
                  }
                </td>
              }
            </tr>
            <!-- Price per m² -->
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 font-semibold text-gray-900 whitespace-nowrap">Đơn giá / m²</td>
              @for(property of properties(); track property.id) {
                <td class="px-6 py-4 font-semibold">
                  {{ formatPrice(property.price / property.area) }} / m²
                </td>
              }
            </tr>
             <!-- Bedrooms -->
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 font-semibold text-gray-900 whitespace-nowrap">Phòng ngủ</td>
              @for(property of properties(); track property.id) {
                <td class="px-6 py-4" [class.bg-green-100]="property.bedrooms > 0 && property.bedrooms === bestBedrooms()" [class.text-green-800]="property.bedrooms > 0 && property.bedrooms === bestBedrooms()">
                  @if (property.type !== 'Đất') {
                    {{ property.bedrooms }}
                  } @else {
                    <span class="text-gray-400">—</span>
                  }
                </td>
              }
            </tr>
             <!-- Bathrooms -->
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 font-semibold text-gray-900 whitespace-nowrap">Phòng tắm</td>
              @for(property of properties(); track property.id) {
                <td class="px-6 py-4" [class.bg-green-100]="property.bathrooms > 0 && property.bathrooms === bestBathrooms()" [class.text-green-800]="property.bathrooms > 0 && property.bathrooms === bestBathrooms()">
                  @if (property.type !== 'Đất') {
                    {{ property.bathrooms }}
                  } @else {
                     <span class="text-gray-400">—</span>
                  }
                </td>
              }
            </tr>
            <!-- Type -->
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 font-semibold text-gray-900 whitespace-nowrap">Loại hình</td>
              @for(property of properties(); track property.id) {
                <td class="px-6 py-4">{{ property.type }}</td>
              }
            </tr>
            <!-- Action -->
            <tr class="bg-gray-50">
              <td class="px-6 py-4 font-semibold text-gray-900 whitespace-nowrap">Hành động</td>
              @for(property of properties(); track property.id) {
                <td class="px-6 py-4">
                  <a href="#" class="font-medium text-green-600 dark:text-green-500 hover:underline">Xem chi tiết</a>
                </td>
              }
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

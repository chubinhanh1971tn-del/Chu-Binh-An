<app-header></app-header>

<div class="bg-white min-h-screen">
  <main class="py-16 sm:py-24">
    <div class="container mx-auto px-4">
      <!-- Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl sm:text-5xl font-bold text-gray-800 tracking-tight">Góc Tư Vấn Chuyên Sâu</h1>
        <p class="mt-4 text-xl text-gray-600">Phân tích chuyên sâu cùng Môi Giới AI (MGA)</p>
      </div>

      <!-- Main Content -->
      <div class="max-w-4xl mx-auto">
        <!-- AI Not Configured Warning -->
        @if (!isAiConfigured() || !isAiFeatureEnabled()) {
            <div class="bg-yellow-50 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-r-lg mb-8" role="alert">
                <p class="font-bold">Tính năng AI chưa sẵn sàng</p>
                <p>Vui lòng vào mục "Cài đặt" (biểu tượng ở chân trang) để cung cấp API Key và bật tính năng AI để sử dụng công cụ tư vấn này.</p>
            </div>
        }

        <!-- Tab Navigation -->
        <div class="mb-8">
          <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
              <button 
                (click)="activeTab.set('fengShui')"
                class="py-4 px-1 border-b-2 font-medium text-lg transition-colors"
                [class]="activeTab() === 'fengShui' ? 'border-yellow-500 text-yellow-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'">
                Tư vấn Phong Thủy
              </button>
              <button 
                (click)="activeTab.set('investment')"
                class="py-4 px-1 border-b-2 font-medium text-lg transition-colors"
                [class]="activeTab() === 'investment' ? 'border-yellow-500 text-yellow-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'">
                Tư vấn Đầu tư
              </button>
            </nav>
          </div>
        </div>

        <!-- Tab Content -->
        <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg border">
          @if (activeTab() === 'fengShui') {
            <!-- Feng Shui Tab -->
            <div class="animate-fade-in">
              <h2 class="text-2xl font-bold text-gray-800 mb-2">Phân Tích Phong Thủy Cá Nhân</h2>
              <p class="text-gray-600 mb-6">Nhập thông tin của bạn để MGA phân tích sự tương hợp năng lượng với hướng nhà.</p>
              
              <form #fengShuiForm="ngForm" (ngSubmit)="getFengShuiAnalysis()">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6">
                  <div>
                    <label for="birthYear" class="block text-sm font-medium text-gray-700 mb-1">Năm sinh (dương lịch) *</label>
                    <input type="number" id="birthYear" name="birthYear" [(ngModel)]="fengShuiData.birthYear" required min="1900" [max]="(new Date()).getFullYear()" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500">
                  </div>
                  <div>
                    <label for="direction" class="block text-sm font-medium text-gray-700 mb-1">Hướng nhà *</label>
                    <select id="direction" name="direction" [(ngModel)]="fengShuiData.direction" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 bg-white">
                      <option>Đông</option>
                      <option>Tây</option>
                      <option>Nam</option>
                      <option>Bắc</option>
                      <option>Đông Bắc</option>
                      <option>Đông Nam</option>
                      <option>Tây Bắc</option>
                      <option>Tây Nam</option>
                    </select>
                  </div>
                </div>
                <button type="submit" [disabled]="!fengShuiForm.form.valid || isGeneratingFengShui() || !isAiConfigured() || !isAiFeatureEnabled()" class="w-full sm:w-auto bg-yellow-500 text-gray-900 font-bold py-2.5 px-6 rounded-lg hover:bg-yellow-400 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center">
                   @if (isGeneratingFengShui()) {
                     <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                     <span>Đang phân tích...</span>
                   } @else {
                    <span>Nhờ MGA Phân Tích</span>
                   }
                </button>
              </form>
              
              @if (fengShuiResult(); as result) {
                <div class="mt-8 pt-6 border-t animate-fade-in">
                   @if (result.error) {
                    <p class="text-red-600">{{ result.error }}</p>
                   } @else {
                     <h3 class="text-xl font-bold text-gray-800 mb-4">{{ result.analysisTitle }}</h3>
                     <div class="space-y-4 text-gray-700">
                       <p><strong class="font-semibold text-gray-800">Phân tích bản mệnh:</strong> {{ result.personAnalysis }}</p>
                       <p><strong class="font-semibold text-gray-800">Độ hợp hướng nhà:</strong> {{ result.houseCompatibility }}</p>
                       <p><strong class="font-semibold text-gray-800">Gợi ý bài trí:</strong> {{ result.suggestions }}</p>
                       <p class="text-sm text-gray-500 italic mt-4">{{ result.disclaimer }}</p>
                     </div>
                   }
                </div>
              }
            </div>
          } @else {
            <!-- Investment Tab -->
             <div class="animate-fade-in">
              <h2 class="text-2xl font-bold text-gray-800 mb-2">Định Hướng Chiến Lược Đầu Tư</h2>
              <p class="text-gray-600 mb-6">Cung cấp thông tin để MGA đề xuất chiến lược đầu tư bất động sản tại Thái Nguyên.</p>
              
               <!-- Philosophy Section -->
              <div class="p-6 border-l-4 border-yellow-500 bg-yellow-50 rounded-r-lg mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-3">Tầm Nhìn: Không Cần Trung Gian Đầu Tư</h3>
                <div class="text-gray-700 leading-relaxed space-y-3">
                  <p class="font-semibold italic">
                    "Chúng ta không cần trung gian đầu tư."
                  </p>
                  <p>
                    Triết lý này là kim chỉ nam của chúng tôi. MGA được sinh ra để thay thế vai trò của các trung gian truyền thống. Thay vì phải dựa vào những lời khuyên thiếu khách quan, giờ đây bạn có thể trực tiếp tiếp cận những phân tích dựa trên dữ liệu, trở thành người tự ra quyết định cho tương lai tài chính của mình.
                  </p>
                </div>
              </div>

              <form #investmentForm="ngForm" (ngSubmit)="getInvestmentAdvice()">
                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6">
                  <div>
                    <label for="budget" class="block text-sm font-medium text-gray-700 mb-1">Ngân sách (VNĐ) *</label>
                    <input type="number" id="budget" name="budget" [(ngModel)]="investmentData.budget" required min="100000000" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500">
                  </div>
                  <div>
                    <label for="goal" class="block text-sm font-medium text-gray-700 mb-1">Mục tiêu chính *</label>
                    <select id="goal" name="goal" [(ngModel)]="investmentData.goal" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 bg-white">
                      <option>Tăng trưởng dài hạn</option>
                      <option>Dòng tiền cho thuê</option>
                      <option>Đầu tư lướt sóng</option>
                      <option>An cư & Tích sản</option>
                    </select>
                  </div>
                </div>
                <div class="mb-6">
                   <label for="risk" class="block text-sm font-medium text-gray-700 mb-1">Mức độ chấp nhận rủi ro *</label>
                    <select id="risk" name="risk" [(ngModel)]="investmentData.risk" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 bg-white">
                      <option>Thấp</option>
                      <option>Trung bình</option>
                      <option>Cao</option>
                    </select>
                </div>
                <button type="submit" [disabled]="!investmentForm.form.valid || isGeneratingInvestment() || !isAiConfigured() || !isAiFeatureEnabled()" class="w-full sm:w-auto bg-yellow-500 text-gray-900 font-bold py-2.5 px-6 rounded-lg hover:bg-yellow-400 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center">
                   @if (isGeneratingInvestment()) {
                     <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                     <span>Đang tạo chiến lược...</span>
                   } @else {
                    <span>Nhờ MGA Tư Vấn</span>
                   }
                </button>
              </form>

              @if (investmentResult(); as result) {
                <div class="mt-8 pt-6 border-t animate-fade-in">
                   @if (result.error) {
                    <p class="text-red-600">{{ result.error }}</p>
                   } @else {
                     <h3 class="text-xl font-bold text-gray-800 mb-4">{{ result.strategyTitle }}</h3>
                     <div class="space-y-4 text-gray-700">
                       <p><strong class="font-semibold text-gray-800">Phân khúc đề xuất:</strong> {{ result.marketSegment }}</p>
                       <p><strong class="font-semibold text-gray-800">Khu vực tiềm năng:</strong> {{ result.locationFocus }}</p>
                       <p><strong class="font-semibold text-gray-800">Lưu ý quan trọng:</strong> {{ result.keyConsiderations }}</p>
                       <p class="text-sm text-gray-500 italic mt-4">{{ result.disclaimer }}</p>
                     </div>
                   }
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>
  </main>
</div>

<app-footer></app-footer>

<div class="fixed inset-0 bg-black/60 z-40 flex items-center justify-center p-4 animate-fade-in" (click)="closeModal()">
  <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-4xl mx-auto animate-scale-up" (click)="$event.stopPropagation()">
    
    <div class="flex justify-between items-center p-5 border-b border-gray-200">
      <h3 class="text-xl font-bold text-gray-800">Kênh Kết Nối</h3>
      <button (click)="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors" aria-label="Đóng">
        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Left Column: Direct Contact -->
      <div class="flex flex-col items-center text-center p-6 bg-gray-50 rounded-lg border">
        <h4 class="text-lg font-semibold text-gray-800 mb-4">Kết nối trực tiếp</h4>
        <p class="text-sm text-gray-600 mb-4">Quét mã Zalo để trò chuyện trực tiếp với người sáng lập Chu Bình An.</p>
        <div class="p-2 bg-white border rounded-lg shadow-sm mb-6">
          <img [src]="zaloQrCodeUrl" alt="Zalo QR Code" class="w-48 h-48">
        </div>
        <a [href]="'tel:' + phoneNumber" class="w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center space-x-2">
          <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3.5A1.5 1.5 0 0 1 3.5 2h1.148a1.5 1.5 0 0 1 1.465 1.175l.716 3.223a1.5 1.5 0 0 1-.242 1.414l-2.223 2.223a.75.75 0 0 0 .03 1.06.15.15 0 0 0 .022.022 12.378 12.378 0 0 0 6.25 6.25.15.15 0 0 0 .022.022.75.75 0 0 0 1.06.03l2.223-2.223a1.5 1.5 0 0 1 1.414-.242l3.223.716A1.5 1.5 0 0 1 18 15.352V16.5a1.5 1.5 0 0 1-1.5 1.5h-.053a16.018 16.018 0 0 1-15.15-15.15A1.5 1.5 0 0 1 3.5 2h.053Z" /></svg>
          <span>Gọi ngay: {{ phoneNumber }}</span>
        </a>
      </div>

      <!-- Right Column: Form -->
      <div>
        <h4 class="text-lg font-semibold text-gray-800 mb-4 text-center md:text-left">Hoặc để lại lời nhắn</h4>
        <form #contactForm="ngForm" (ngSubmit)="submitForm()">
          <div class="space-y-4">
            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
              <p class="text-sm text-gray-500">Bất động sản:</p>
              <p class="font-semibold text-gray-800 line-clamp-1">{{ property().title }}</p>
            </div>
            
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Họ và tên *</label>
              <input type="text" name="name" id="name" required [(ngModel)]="contact.name" #name="ngModel" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
              @if (name.invalid && (name.dirty || name.touched)) {
                <p class="text-red-500 text-xs mt-1">Vui lòng nhập họ và tên.</p>
              }
            </div>
            
            <div>
              <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Số điện thoại *</label>
              <input type="tel" name="phone" id="phone" required [(ngModel)]="contact.phone" #phone="ngModel" (ngModelChange)="formatPhoneNumber($event)" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
              @if (phone.invalid && (phone.dirty || phone.touched)) {
                <p class="text-red-500 text-xs mt-1">Vui lòng nhập số điện thoại.</p>
              }
            </div>
            
            <div>
              <label for="message" class="block text-sm font-medium text-gray-700 mb-1">Lời nhắn</label>
              <textarea name="message" id="message" rows="3" [(ngModel)]="contact.message" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></textarea>
            </div>
          </div>
          
          <div class="mt-6">
            <button type="submit" [disabled]="!contactForm.form.valid" class="w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
              Gửi Yêu Cầu
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
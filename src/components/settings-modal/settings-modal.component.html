<div class="fixed inset-0 bg-black/60 z-40 flex items-center justify-center p-4 animate-fade-in" (click)="closeModal()">
  <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-lg mx-auto animate-scale-up" (click)="$event.stopPropagation()">
    
    <div class="flex justify-between items-center p-5 border-b border-gray-200">
      <h3 class="text-xl font-bold text-gray-800">Cài đặt & Tùy chỉnh</h3>
      <button (click)="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors" aria-label="Đóng">
        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="p-6 space-y-6">
      <div>
        <h4 class="text-lg font-semibold text-gray-800 mb-2">Kích hoạt Tính năng AI</h4>
        <p class="text-sm text-gray-600 mb-3">
          Để sử dụng các tính năng thông minh như tự động tạo mô tả và phân tích từ "Môi Giới AI", bạn cần cung cấp một API Key từ Google.
        </p>
        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-sm text-green-600 hover:underline font-medium">
          Nhấp vào đây để lấy API Key miễn phí của bạn &rarr;
        </a>
      </div>
      <div>
        <label for="api-key" class="block text-sm font-medium text-gray-700 mb-1">Google Gemini API Key</label>
        <input 
            type="password" 
            id="api-key"
            name="apiKey"
            placeholder="Dán API Key của bạn vào đây"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"
            [ngModel]="apiKeyInput()"
            (ngModelChange)="apiKeyInput.set($event)">
         <p class="text-xs mt-1" [class.text-gray-500]="!isKeyValid()" [class.text-green-600]="isKeyValid()">
            Độ dài yêu cầu: 38+ ký tự. Hiện tại: {{ apiKeyInput().trim().length }}
        </p>
      </div>
       <div class="flex justify-between items-center bg-gray-50 p-3 rounded-md border">
          <span class="font-medium text-sm text-gray-700">Bật/Tắt tất cả tính năng AI</span>
          <label for="ai-toggle" class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="ai-toggle" class="sr-only peer" [checked]="isAiFeatureEnabled()" (change)="toggleAiFeature()">
              <div class="w-11 h-6 bg-gray-300 rounded-full peer peer-focus:ring-2 peer-focus:ring-green-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
          </label>
      </div>
    </div>

    <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 flex justify-end">
      <button 
        type="button" 
        (click)="saveSettings()"
        [disabled]="!isKeyValid()"
        class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
        Lưu & Kích hoạt
      </button>
    </div>

  </div>
</div>